#ifndef Thermistor_h
#define Thermistor_h

#include "Arduino.h"

#define thermistor_pin 0
#define TABLE_SIZE 159

#define THERMISTOR_NUM_SAMPLES 15

class Thermistor{
  public:

    Thermistor();
    bool update();
    float temperature();
    void set_samples(int n);

  private:

    uint8_t sample_index = 0;
    int samples[THERMISTOR_NUM_SAMPLES];

    void _calculate_average_adc();
    float _average_adc;

    // lookup table provided for thermistor PN: KS103J2
    const int TABLE[TABLE_SIZE][2] = {
      // ADC, Celsius
      {927, -20},
      {922, -19},
      {917, -18},
      {911, -17},
      {906, -16},
      {900, -15},
      {893, -14},
      {887, -13},
      {880, -12},
      {874, -11},
      {866, -10},
      {859, -9},
      {852, -8},
      {844, -7},
      {836, -6},
      {827, -5},
      {819, -4},
      {810, -3},
      {802, -2},
      {792, -1},
      {783, 0},
      {774, 1},
      {764, 2},
      {754, 3},
      {744, 4},
      {734, 5},
      {724, 6},
      {713, 7},
      {702, 8},
      {692, 9},
      {681, 10},
      {670, 11},
      {659, 12},
      {648, 13},
      {636, 14},
      {625, 15},
      {614, 16},
      {602, 17},
      {591, 18},
      {580, 19},
      {568, 20},
      {557, 21},
      {545, 22},
      {534, 23},
      {523, 24},
      {512, 25},
      {500, 26},
      {489, 27},
      {478, 28},
      {467, 29},
      {456, 30},
      {446, 31},
      {435, 32},
      {425, 33},
      {414, 34},
      {404, 35},
      {394, 36},
      {384, 37},
      {374, 38},
      {365, 39},
      {356, 40},
      {346, 41},
      {337, 42},
      {328, 43},
      {320, 44},
      {311, 45},
      {303, 46},
      {294, 47},
      {286, 48},
      {279, 49},
      {271, 50},
      {263, 51},
      {256, 52},
      {249, 53},
      {242, 54},
      {235, 55},
      {229, 56},
      {222, 57},
      {216, 58},
      {210, 59},
      {204, 60},
      {198, 61},
      {192, 62},
      {187, 63},
      {182, 64},
      {176, 65},
      {171, 66},
      {166, 67},
      {162, 68},
      {157, 69},
      {152, 70},
      {148, 71},
      {144, 72},
      {140, 73},
      {136, 74},
      {132, 75},
      {128, 76},
      {132, 75},
      {128, 76},
      {124, 77},
      {121, 78},
      {117, 79},
      {114, 80},
      {111, 81},
      {108, 82},
      {105, 83},
      {102, 84},
      {99, 85},
      {96, 86},
      {93, 87},
      {91, 88},
      {88, 89},
      {86, 90},
      {83, 91},
      {81, 92},
      {79, 93},
      {77, 94},
      {75, 95},
      {73, 96},
      {71, 97},
      {69, 98},
      {67, 99},
      {65, 100},
      {63, 101},
      {62, 102},
      {60, 103},
      {58, 104},
      {57, 105},
      {55, 106},
      {54, 107},
      {52, 108},
      {51, 109},
      {50, 110},
      {48, 111},
      {47, 112},
      {46, 113},
      {45, 114},
      {44, 115},
      {42, 116},
      {41, 117},
      {40, 118},
      {39, 119},
      {38, 120},
      {37, 121},
      {36, 122},
      {36, 123},
      {35, 124},
      {34, 125},
      {33, 126},
      {32, 127},
      {31, 128},
      {31, 129},
      {30, 130},
      {29, 131},
      {28, 132},
      {28, 133},
      {27, 134},
      {26, 135}
    };

};

#endif
